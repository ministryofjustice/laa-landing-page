databaseChangeLog:
  # Insert Playwright Firms with Offices
  - changeSet:
      id: 1761063088678-1
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: |
              -- Insert Firms
              INSERT INTO firm (id, code, name, type, parent_firm_id) VALUES
              ('11111111-1111-1111-1111-111111111111', '90001', 'Automation Firm One', 'LEGAL_SERVICES_PROVIDER', NULL),
              ('22222222-2222-2222-2222-222222222222', '90002', 'Automation Firm Two', 'LEGAL_SERVICES_PROVIDER', NULL);
              
              -- Insert Offices for Firms
              INSERT INTO office (id, firm_id, post_code, address_line_1, address_line_2, city, code) VALUES
              ('33333333-3333-3333-3333-333333333333', '11111111-1111-1111-1111-111111111111', '12345', 'Automation Office 1', '', 'City1', 'THREE'),
              ('44444444-4444-4444-4444-444444444444', '11111111-1111-1111-1111-111111111111', '23456', 'Automation Office 2', '', 'City2', 'FOUR'),
              ('55555555-5555-5555-5555-555555555555', '22222222-2222-2222-2222-222222222222', '34567', 'Automation Office 1', '', 'City3', 'FIVE'),
              ('66666666-6666-6666-6666-666666666666', '22222222-2222-2222-2222-222222222222', '45678', 'Automation Office 2', '', 'City4', 'SIX'),
              ('77777777-7777-7777-7777-777777777777', '22222222-2222-2222-2222-222222222222', '56789', 'Automation Office 3', '', 'City5', 'SEVEN');

  - changeSet:
      id: 1761063088678-2
      author: niall.mcmahon
      context: playwright
      changes:
        # Global Admin
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user  (id,email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date) VALUES (gen_random_uuid(), 'playwright-globaladmin@playwrighttest.com','Playwright', 'GlobalAdmin', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, last_modified_date, created_by, last_modified_by, last_sync_successful) VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-globaladmin@playwrighttest.com'), true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role(user_profile_id, app_role_id) VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id WHERE u.email = 'playwright-globaladmin@playwrighttest.com'), (SELECT id FROM app_role where name = 'Global Admin'))"

  # User with No Roles
  - changeSet:
      id: 1761063088678-3
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                    VALUES (gen_random_uuid(), 'playwright-noroles@playwrighttest.com','Playwright', 'NoRoles', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW()),
                           (gen_random_uuid(), 'playwright-extofficeuser@playwrighttest.com','Playwright', 'Extuser', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, last_modified_date, created_by, last_modified_by, last_sync_successful, firm_id, unrestricted_office_access)
                    VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-noroles@playwrighttest.com'), true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false, null, false),
                           (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-extofficeuser@playwrighttest.com'), true, 'COMPLETE', 'EXTERNAL', NOW(), NOW(), 'System', 'System', false, '11111111-1111-1111-1111-111111111111', true)"

  # Internal User Viewer
  - changeSet:
      id: 1761063088678-4
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                   VALUES (gen_random_uuid(), 'playwright-internaluserviewer@playwrighttest.com', 'Playwright', 'InternalUserViewer', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, last_modified_date, created_by, last_modified_by, last_sync_successful)
                   VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-internaluserviewer@playwrighttest.com'),
                   true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (user_profile_id, app_role_id)
                   VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id
                            WHERE u.email = 'playwright-internaluserviewer@playwrighttest.com'),
                           (SELECT id FROM app_role WHERE name = 'Internal User Viewer'))"

  # Internal User Manager
  - changeSet:
      id: 1761063088678-5
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                   VALUES (gen_random_uuid(), 'playwright-internalusermanager@playwrighttest.com', 'Playwright', 'InternalUserManager', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, last_modified_date, created_by, last_modified_by, last_sync_successful)
                   VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-internalusermanager@playwrighttest.com'),
                   true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (user_profile_id, app_role_id)
                   VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id
                            WHERE u.email = 'playwright-internalusermanager@playwrighttest.com'),
                           (SELECT id FROM app_role WHERE name = 'Internal User Manager'))"
  # External User Manager
  - changeSet:
      id: 1761063088678-7
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                  VALUES (gen_random_uuid(), 'playwright-externalusermanager@playwrighttest.com', 'Playwright', 'ExternalUserManager', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, 
            last_modified_date, created_by, last_modified_by, last_sync_successful)
                  VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-externalusermanager@playwrighttest.com'),
                  true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (user_profile_id, app_role_id)
                  VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id
                           WHERE u.email = 'playwright-externalusermanager@playwrighttest.com'),
                          (SELECT id FROM app_role WHERE name = 'External User Manager'))"

  # External User Admin
  - changeSet:
      id: 1761063088678-8
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                  VALUES (gen_random_uuid(), 'playwright-externaluseradmin@playwrighttest.com', 'Playwright', 'ExternalUserAdmin', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, last_modified_date, created_by, last_modified_by, last_sync_successful)
                  VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-externaluseradmin@playwrighttest.com'),
                  true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (user_profile_id, app_role_id)
                  VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id
                           WHERE u.email = 'playwright-externaluseradmin@playwrighttest.com'),
                          (SELECT id FROM app_role WHERE name = 'External User Admin'))"

  # External User Viewer
  - changeSet:
      id: 1761063088678-6
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                  VALUES (gen_random_uuid(), 'playwright-externaluserviewer@playwrighttest.com', 'Playwright', 'ExternalUserViewer', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, last_modified_date, created_by, last_modified_by, last_sync_successful)
                  VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-externaluserviewer@playwrighttest.com'),
                  true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (user_profile_id, app_role_id)
                  VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id
                           WHERE u.email = 'playwright-externaluserviewer@playwrighttest.com'),
                          (SELECT id FROM app_role WHERE name = 'External User Viewer'))"

  # SiLAS Administration
  - changeSet:
      id: 1769183038683-1
      author: majid.elmi
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                  VALUES (gen_random_uuid(), 'playwright-silasadministration@playwrighttest.com', 'Playwright', 'SiLASSystemAdministration', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, active_profile, status, user_type, created_date, 
            last_modified_date, created_by, last_modified_by, last_sync_successful)
                  VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-silasadministration@playwrighttest.com'),
                  true, 'COMPLETE', 'INTERNAL', NOW(), NOW(), 'System', 'System', false)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (user_profile_id, app_role_id)
                  VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id
                           WHERE u.email = 'playwright-silasadministration@playwrighttest.com'),
                          (SELECT id FROM app_role WHERE name = 'SILAS System Administration'))"

  # Security Response
  - changeSet:
      id: 1761063088678-11
      author: chris.marron
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (
                  id,
                  email,
                  first_name,
                  last_name,
                  entra_oid,
                  status,
                  multi_firm_user,
                  created_by,
                  last_modified_by,
                  created_date,
                  last_modified_date
                )
                VALUES (
                  gen_random_uuid(),
                  'playwright-informationassurance@playwrighttest.com',
                  'Playwright',
                  'InformationAssurance',
                  gen_random_uuid(),
                  'ACTIVE',
                  false,
                  'System',
                  'System',
                  NOW(),
                  NOW()
                )"

        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (
                  id,
                  entra_user_id,
                  active_profile,
                  status,
                  user_type,
                  created_date,
                  last_modified_date,
                  created_by,
                  last_modified_by,
                  last_sync_successful
                )
                VALUES (
                  gen_random_uuid(),
                  (SELECT id FROM entra_user
                   WHERE email = 'playwright-informationassurance@playwrighttest.com'),
                  true,
                  'COMPLETE',
                  'INTERNAL',
                  NOW(),
                  NOW(),
                  'System',
                  'System',
                  false
                )"

        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (
                  user_profile_id,
                  app_role_id
                )
                VALUES (
                  (SELECT up.id
                   FROM user_profile up
                   JOIN entra_user u ON up.entra_user_id = u.id
                   WHERE u.email = 'playwright-informationassurance@playwrighttest.com'),
                  (SELECT id FROM app_role
                   WHERE name = 'Security Response')
                )"

  - changeSet:
      id: 1761063088678-12
      author: chris.marron
      context: playwright
      changes:

        # Insert entra user
        - sql:
            dbms: postgresql
            sql: >
              INSERT INTO entra_user (
                id,
                email,
                first_name,
                last_name,
                entra_oid,
                status,
                multi_firm_user,
                created_by,
                last_modified_by,
                created_date,
                last_modified_date
              )
              VALUES (
                gen_random_uuid(),
                'playwright-firmusermanager@playwrighttest.com',
                'Playwright',
                'FirmUserManager',
                gen_random_uuid(),
                'ACTIVE',
                false,
                'System',
                'System',
                NOW(),
                NOW()
              );
        - sql:
            dbms: postgresql
            sql: >
              INSERT INTO entra_user (
                id,
                email,
                first_name,
                last_name,
                entra_oid,
                status,
                multi_firm_user,
                created_by,
                last_modified_by,
                created_date,
                last_modified_date
              )
              VALUES (
                gen_random_uuid(),
                'externaluser-incomplete@playwrighttest.com',
                'Playwright',
                'ExternalUserIncomplete',
                gen_random_uuid(),
                'ACTIVE',
                false,
                'System',
                'System',
                NOW(),
                NOW()
              );

        # Insert EXTERNAL user profile (firm_id required)
        - sql:
            dbms: postgresql
            sql: >
              INSERT INTO user_profile (
                id,
                entra_user_id,
                firm_id,
                active_profile,
                status,
                user_type,
                created_date,
                last_modified_date,
                created_by,
                last_modified_by,
                last_sync_successful,
                unrestricted_office_access
              )
              VALUES (
                gen_random_uuid(),
                (SELECT id FROM entra_user
                 WHERE email = 'playwright-firmusermanager@playwrighttest.com'),
                '11111111-1111-1111-1111-111111111111',
                true,
                'COMPLETE',
                'EXTERNAL',
                NOW(),
                NOW(),
                'System',
                'System',
                false,
                true
              );

        # Insert EXTERNAL user profile (firm_id required), INCOMPLETE
        - sql:
            dbms: postgresql
            sql: >
              INSERT INTO user_profile (
                id,
                entra_user_id,
                firm_id,
                active_profile,
                status,
                user_type,
                created_date,
                last_modified_date,
                created_by,
                last_modified_by,
                last_sync_successful,
                unrestricted_office_access
              )
              VALUES (
                gen_random_uuid(),
                (SELECT id FROM entra_user
                 WHERE email = 'externaluser-incomplete@playwrighttest.com'),
                '11111111-1111-1111-1111-111111111111',
                true,
                'PENDING',
                'EXTERNAL',
                NOW(),
                NOW(),
                'System',
                'System',
                false,
                true
              );

        # Assign Firm User Manager role
        - sql:
            dbms: postgresql
            sql: >
              INSERT INTO user_profile_app_role (
                user_profile_id,
                app_role_id
              )
              VALUES (
                (SELECT up.id
                 FROM user_profile up
                 JOIN entra_user u ON up.entra_user_id = u.id
                 WHERE u.email = 'playwright-firmusermanager@playwrighttest.com'),
                (SELECT id
                 FROM app_role
                 WHERE name = 'Firm User Manager')
              );

  - changeSet:
      id: 1770936555-13
      author: suresh kavali
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: |
              -- Insert apps
              INSERT INTO public.app (
              id, entra_app_id, name, security_group_name, security_group_oid,
              ordinal, enabled, title, description, oid_group_name, url, app_type
              )
              VALUES (
              '88888888-8888-8888-8888-888888888888',
              'aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa',
              'Test LAA App One',
              'Test LAA App One',
              'Test LAA App One',
              1, TRUE,
              'Test LAA App One',
              'Test LAA App One',
              'Test LAA App One',
              '#',
              'LAA'
              );
              
              INSERT INTO public.app (
              id, entra_app_id, name, security_group_name, security_group_oid,
              ordinal, enabled, title, description, oid_group_name, url, app_type
              )
              VALUES (
              '99999999-9999-9999-9999-999999999999',
              'bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb',
              'Test LAA App Two',
              'Test LAA App Two',
              'Test LAA App Two',
              2, TRUE,
              'Test LAA App Two',
              'Test LAA App Two',
              'Test LAA App Two',
              '#',
              'LAA'
              );

              -- Insert app roles
              INSERT INTO public.app_role (
              authz_role, app_id, id, description, name, user_type_restriction, ordinal
              )
              VALUES (
              FALSE,
              '88888888-8888-8888-8888-888888888888',  -- fixed
              'dddddddd-dddd-dddd-dddd-aaaaaaaaaaaa',
              'Test LAA App One Access',
              'Test LAA App One Access',
              '{EXTERNAL}',
              0
              );
              
              INSERT INTO public.app_role (
              authz_role, app_id, id, description, name, user_type_restriction, ordinal
              )
              VALUES (
              FALSE,
              '99999999-9999-9999-9999-999999999999',
              'ffffffff-ffff-ffff-ffff-aaaaaaaaaaaa',
              'Test LAA App Two Access',
              'Test LAA App Two Access',
              '{EXTERNAL}',
              0
              );


  # External User in Different Firm - testing cross-firm access restrictions
  - changeSet:
      id: 1772009711855-14
      author: yusuf.shah
      context: playwright
      changes:
        - sql:
            dbms: postgresql
            sql: "INSERT INTO entra_user (id, email, first_name, last_name, entra_oid, status, multi_firm_user, created_by, last_modified_by, created_date, last_modified_date)
                  VALUES (gen_random_uuid(), 'playwright-firmtwouserviewer@playwrighttest.com', 'Playwright', 'FirmTwoUserViewer', gen_random_uuid(), 'ACTIVE', false, 'System', 'System', NOW(), NOW())"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile (id, entra_user_id, firm_id, active_profile, status, user_type, created_date, last_modified_date, created_by, last_modified_by, last_sync_successful, unrestricted_office_access)
                  VALUES (gen_random_uuid(), (SELECT id FROM entra_user WHERE email = 'playwright-firmtwouserviewer@playwrighttest.com'),
                  '22222222-2222-2222-2222-222222222222', true, 'COMPLETE', 'EXTERNAL', NOW(), NOW(), 'System', 'System', false, true)"
        - sql:
            dbms: postgresql
            sql: "INSERT INTO user_profile_app_role (user_profile_id, app_role_id)
                  VALUES ((SELECT up.id FROM user_profile up JOIN entra_user u ON up.entra_user_id = u.id
                           WHERE u.email = 'playwright-firmtwouserviewer@playwrighttest.com'),
                          (SELECT id FROM app_role WHERE name = 'External User Viewer'))"

  # Fix External User Admin and External User Viewer to be EXTERNAL users in Firm One
  - changeSet:
      id: 1772009711855-15
      author: yusuf.shah
      context: playwright
      comment: "Update External User Admin and External User Viewer to be EXTERNAL type with firm assignments for Firm User Manager testing"
      changes:
        # Update External User Admin to be EXTERNAL type and assign to Firm One
        - sql:
            dbms: postgresql
            sql: |
              UPDATE user_profile
              SET user_type = 'EXTERNAL',
                  firm_id = '11111111-1111-1111-1111-111111111111',
                  unrestricted_office_access = true
              WHERE entra_user_id = (SELECT id FROM entra_user WHERE email = 'playwright-externaluseradmin@playwrighttest.com');

        # Update External User Viewer to be EXTERNAL type and assign to Firm One
        - sql:
            dbms: postgresql
            sql: |
              UPDATE user_profile
              SET user_type = 'EXTERNAL',
                  firm_id = '11111111-1111-1111-1111-111111111111',
                  unrestricted_office_access = true
              WHERE entra_user_id = (SELECT id FROM entra_user WHERE email = 'playwright-externaluserviewer@playwrighttest.com');