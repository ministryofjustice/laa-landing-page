databaseChangeLog:
  - changeSet:
      id: 1763564262149-1
      author: suresh.kavali
      changes:
        - addColumn:
            tableName: app
            columns:
              - column:
                  name: title
                  type: varchar(255)
                  constraints:
                    nullable: true
              - column:
                  name: description
                  type: TEXT
                  constraints:
                    nullable: true
              - column:
                  name: assigned_app_id
                  type: UUID
                  constraints:
                    nullable: true
              - column:
                  name: alternative_description
                  type: TEXT
                  constraints:
                    nullable: true
              - column:
                  name: oid_group_name
                  type: varchar(255)
                  constraints:
                    nullable: true
              - column:
                  name: url
                  type: varchar(255)
                  constraints:
                    nullable: true
              - column:
                  name: app_type
                  type: varchar(255)
                  constraints:
                    nullable: true
      rollback:
        - dropColumn: { tableName: app, columnName: title }
        - dropColumn: { tableName: app, columnName: description }
        - dropColumn: { tableName: app, columnName: oid_group_name }
        - dropColumn: { tableName: app, columnName: url }
        - dropColumn: { tableName: app, columnName: app_type }
        - dropColumn: { tableName: app, columnName: assigned_app_id }
        - dropColumn: { tableName: app, columnName: alternative_description }

  - changeSet:
      id: 1763564262149-2
      author: suresh.kavali
      changes:
        - addColumn:
            tableName: app_role
            columns:
              - column:
                  name: firm_type_restriction
                  type: varchar(255)
                  constraints:
                    nullable: true
      rollback:
        - dropColumn: { tableName: app_role, columnName: firm_type_restriction }

  - changeSet:
      id: 1763564262149-3
      author: suresh.kavali
      changes:
        - sql:
            dbms: postgresql
            sql: |
              ALTER TABLE app
              ADD CONSTRAINT app_app_type_check
              CHECK ((app_type)::text = ANY ((ARRAY['AUTHZ'::character varying, 'LAA'::character varying])::text[]));
        - sql:
            dbms: postgresql
            sql: |
              ALTER TABLE app_role
              ADD CONSTRAINT app_role_firm_type_restriction_check
              CHECK ((firm_type_restriction)::text = ANY ((ARRAY['LEGAL_SERVICES_PROVIDER'::character varying, 'CHAMBERS'::character varying, 'ADVOCATE'::character varying])::text[]));

  - changeSet:
      id: 1763564262149-4
      author: suresh.kavali
      changes:
        - sql:
            sql: |
              UPDATE app
              SET title = name,
                  description = name,
                  oid_group_name = name,
                  app_type = 'LAA',
                  url = '#'
              WHERE title IS NULL
                AND description IS NULL
                AND oid_group_name IS NULL
                AND app_type IS NULL;
      rollback:
        - sql:
            sql: |
              UPDATE app
              SET title = NULL,
                  description = NULL,
                  oid_group_name = NULL,
                  app_type = NULL,
                  url = NULL
              WHERE title = name
                AND description = name
                AND oid_group_name = name
                AND app_type = 'LAA'
                AND url = '#';

  - changeSet:
      id: 1763564262149-5
      author: suresh.kavali
      changes:
        - addNotNullConstraint:
            tableName: app
            columnName: title
            columnDataType: varchar(255)
        - addNotNullConstraint:
            tableName: app
            columnName: description
            columnDataType: TEXT
        - addNotNullConstraint:
            tableName: app
            columnName: oid_group_name
            columnDataType: varchar(255)
        - addNotNullConstraint:
            tableName: app
            columnName: app_type
            columnDataType: varchar(255)
        - addNotNullConstraint:
            tableName: app
            columnName: url
            columnDataType: varchar(255)
        - addUniqueConstraint:
            tableName: app
            columnNames: title
            constraintName: uq_app_title
        - addUniqueConstraint:
            tableName: app
            columnNames: description
            constraintName: uq_app_description
        - addUniqueConstraint:
            tableName: app
            columnNames: oid_group_name
            constraintName: uq_app_oid_group_name
      rollback:
        - dropNotNullConstraint:
            tableName: app
            columnName: title
            columnDataType: varchar(255)
        - dropNotNullConstraint:
            tableName: app
            columnName: description
            columnDataType: TEXT
        - dropNotNullConstraint:
            tableName: app
            columnName: oid_group_name
            columnDataType: varchar(255)
        - dropNotNullConstraint:
            tableName: app
            columnName: app_type
            columnDataType: varchar(255)
        - dropNotNullConstraint:
            tableName: app
            columnName: url
            columnDataType: varchar(255)
        - dropUniqueConstraint:
            tableName: app
            constraintName: uq_app_title
        - dropUniqueConstraint:
            tableName: app
            constraintName: uq_app_description
        - dropUniqueConstraint:
            tableName: app
            constraintName: uq_app_oid_group_name
