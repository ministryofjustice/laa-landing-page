databaseChangeLog:
  - changeSet:
      id: add-silas-system-admin-v1-20260212
      author: suresh.kavali

      changes:

        # -----------------------------------------------------------
        # 1. DELETE specific role_assignment
        # -----------------------------------------------------------
        - sql:
            splitStatements: true
            sql: |
              DELETE FROM role_assignment 
              WHERE assigning_role_id = (
                        SELECT id FROM app_role WHERE name = 'Security Response'
                    )
                AND assignable_role_id = (
                        SELECT id FROM app_role 
                        WHERE name = 'SILAS System Administration'
                    );

        # -----------------------------------------------------------
        # 2. INSERT new role_permission rows
        # -----------------------------------------------------------
        - sql:
            splitStatements: true
            sql: |
              INSERT INTO role_permission (app_role_id, permission)
              VALUES (
                  (SELECT id FROM app_role WHERE name = 'SILAS System Administration'),
                  'EDIT_LAA_APP_METADATA'
              ),
              (
                  (SELECT id FROM app_role WHERE name = 'SILAS System Administration'),
                  'VIEW_LAA_APP_METADATA'
              );

      rollback:

        # -----------------------------------------------------------
        # Undo permissions inserted in this changeset
        # -----------------------------------------------------------
        - sql:
            sql: |
              DELETE FROM role_permission
              WHERE permission IN ('EDIT_LAA_APP_METADATA', 'VIEW_LAA_APP_METADATA')
                AND app_role_id = (
                    SELECT id FROM app_role 
                    WHERE name = 'SILAS System Administration'
                );

        # -----------------------------------------------------------
        # Restore the deleted role_assignment
        # -----------------------------------------------------------
        - sql:
            sql: |
              INSERT INTO role_assignment (assigning_role_id, assignable_role_id)
              VALUES (
                (SELECT id FROM app_role WHERE name = 'Security Response'),
                (SELECT id FROM app_role WHERE name = 'SILAS System Administration')
              );
