databaseChangeLog:
  - changeSet:
      id: update-authz-app-types
      author: suresh.kavali
      changes:
        - sql:
            dbms: postgresql
            sql: "UPDATE app set app_type = 'AUTHZ' where name in ('Manage Your Users', 'User Access Audit Table');"
      rollback:
        - sql:
            dbms: postgresql
            sql: "UPDATE app set app_type = 'LAA' where name in ('Manage Your Users', 'User Access Audit Table');"

  - changeSet:
      id: add-performance-indexes-pda-sync
      author: paul.snowdon
      runInTransaction: false
      comment: Add performance indexes to optimize PDA synchronization operations
      changes:
        - sql:
            comment: Create firm code index for sync lookups
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_firm_code ON firm(code) WHERE code IS NOT NULL
        - sql:
            comment: Create firm name index for duplicate checks
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_firm_name ON firm(name) WHERE name IS NOT NULL
        - sql:
            comment: Create firm parent relationship index
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_firm_parent_firm_id ON firm(parent_firm_id) WHERE parent_firm_id IS NOT NULL
        - sql:
            comment: Create office code index for sync lookups
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_office_code ON office(code) WHERE code IS NOT NULL
        - sql:
            comment: Create office firm relationship index
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_office_firm_id ON office(firm_id) WHERE firm_id IS NOT NULL
        - sql:
            comment: Create composite office index for firm validation
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_office_firm_id_code ON office(firm_id, code) WHERE firm_id IS NOT NULL AND code IS NOT NULL
        - sql:
            comment: Create user profile firm index for impact analysis
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_profile_firm_id ON user_profile(firm_id) WHERE firm_id IS NOT NULL
        - sql:
            comment: Create user profile office association index
            sql: CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_profile_office_office_id ON user_profile_office(office_id) WHERE office_id IS NOT NULL
      rollback:
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_firm_code
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_firm_name
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_firm_parent_firm_id
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_firm_active
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_office_code
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_office_firm_id
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_office_code
        - sql: DROP INDEX CONCURRENTLY IF EXISTS idx_user_profile_office_office_id
